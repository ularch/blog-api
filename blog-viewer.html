<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„åšå®¢ - Cloudflare D1 é©±åŠ¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .controls h3 {
            margin-bottom: 15px;
            color: #555;
        }

        .controls div {
            margin-bottom: 10px;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background 0.3s;
        }

        button:hover {
            background: #5a6fd8;
        }

        input, select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-right: 10px;
        }

        .posts-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .post {
            padding: 30px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s;
        }

        .post:hover {
            background: #f8f9ff;
        }

        .post:last-child {
            border-bottom: none;
        }

        .post-title {
            color: #333;
            font-size: 1.8em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .post-meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .post-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .post-content {
            margin-bottom: 15px;
            line-height: 1.7;
        }

        .post-excerpt {
            background: #f0f4ff;
            padding: 15px;
            border-left: 4px solid #667eea;
            font-style: italic;
            color: #555;
        }

        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .status-published {
            background: #d4edda;
            color: #155724;
        }

        .status-draft {
            background: #fff3cd;
            color: #856404;
        }

        .status-archived {
            background: #f8d7da;
            color: #721c24;
        }

        .pagination {
            text-align: center;
            padding: 20px;
            background: #f8f9ff;
            font-size: 0.9em;
            color: #666;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.1em;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .create-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: none;
        }

        .create-form.show {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
        }

        .form-group textarea {
            height: 120px;
            resize: vertical;
        }

        .icon {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ æˆ‘çš„åšå®¢ç³»ç»Ÿ</h1>
            <p>ç”± Cloudflare D1 å’Œ Workers é©±åŠ¨</p>
        </div>

        <div class="controls">
            <h3>ğŸ“š åšå®¢ç®¡ç†</h3>
            <div>
                <button onclick="loadPosts()">ğŸ”„ åˆ·æ–°æ–‡ç« </button>
                <button onclick="toggleCreateForm()">âœï¸ å†™æ–°æ–‡ç« </button>
                <button onclick="loadSinglePost()">ğŸ” æŸ¥çœ‹æŒ‡å®šæ–‡ç« </button>
                <input type="number" id="postId" placeholder="æ–‡ç« ID" min="1" style="width: 100px;">
            </div>
            <div>
                <label>çŠ¶æ€ç­›é€‰ï¼š</label>
                <select id="statusFilter" onchange="filterPosts()">
                    <option value="">å…¨éƒ¨çŠ¶æ€</option>
                    <option value="published">å·²å‘å¸ƒ</option>
                    <option value="draft">è‰ç¨¿</option>
                    <option value="archived">å·²å½’æ¡£</option>
                </select>
                
                <label>æ¯é¡µæ˜¾ç¤ºï¼š</label>
                <select id="limitSelect" onchange="loadPosts()">
                    <option value="5">5ç¯‡</option>
                    <option value="10" selected>10ç¯‡</option>
                    <option value="20">20ç¯‡</option>
                </select>
            </div>
        </div>

        <div class="create-form" id="createForm">
            <h3>âœï¸ åˆ›å»ºæ–°æ–‡ç« </h3>
            <form onsubmit="createPost(event)">
                <div class="form-group">
                    <label>æ–‡ç« æ ‡é¢˜</label>
                    <input type="text" id="newTitle" required>
                </div>
                <div class="form-group">
                    <label>ä½œè€…</label>
                    <input type="text" id="newAuthor" required>
                </div>
                <div class="form-group">
                    <label>URLæ ‡è¯† (slug)</label>
                    <input type="text" id="newSlug" required>
                </div>
                <div class="form-group">
                    <label>æ–‡ç« å†…å®¹</label>
                    <textarea id="newContent" required></textarea>
                </div>
                <div class="form-group">
                    <label>æ–‡ç« æ‘˜è¦</label>
                    <input type="text" id="newExcerpt">
                </div>
                <div class="form-group">
                    <label>çŠ¶æ€</label>
                    <select id="newStatus">
                        <option value="draft">è‰ç¨¿</option>
                        <option value="published">å‘å¸ƒ</option>
                        <option value="archived">å½’æ¡£</option>
                    </select>
                </div>
                <button type="submit">ğŸ“ åˆ›å»ºæ–‡ç« </button>
                <button type="button" onclick="toggleCreateForm()">âŒ å–æ¶ˆ</button>
            </form>
        </div>

        <div class="posts-container" id="postsContainer">
            <div class="loading">ğŸ“– æ­£åœ¨åŠ è½½åšå®¢æ–‡ç« ...</div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://api.huaman-lou.top/api';
        let currentPage = 1;

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–æ–‡ç« 
        document.addEventListener('DOMContentLoaded', function() {
            loadPosts();
        });

        // åŠ è½½æ–‡ç« åˆ—è¡¨
        async function loadPosts(page = 1) {
            const container = document.getElementById('postsContainer');
            const limit = document.getElementById('limitSelect').value;
            const status = document.getElementById('statusFilter').value;
            
            container.innerHTML = '<div class="loading">ğŸ“– æ­£åœ¨åŠ è½½åšå®¢æ–‡ç« ...</div>';
            
            try {
                let url = `${API_BASE}/posts?page=${page}&limit=${limit}`;
                if (status) {
                    url += `&status=${status}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                currentPage = page;
                displayPosts(data.posts, data.pagination);
            } catch (error) {
                container.innerHTML = `<div class="error">âŒ åŠ è½½å¤±è´¥: ${error.message}</div>`;
            }
        }

        // æ˜¾ç¤ºæ–‡ç« 
        function displayPosts(posts, pagination) {
            const container = document.getElementById('postsContainer');
            
            if (!posts || posts.length === 0) {
                container.innerHTML = '<div class="loading">ğŸ“ æš‚æ— æ–‡ç« ï¼Œå¼€å§‹åˆ›å»ºä½ çš„ç¬¬ä¸€ç¯‡æ–‡ç« å§ï¼</div>';
                return;
            }

            let html = '';
            posts.forEach(post => {
                const statusClass = `status-${post.status}`;
                html += `
                    <div class="post">
                        <h2 class="post-title">${post.title}</h2>
                        <div class="post-meta">
                            <span>ğŸ‘¤ ${post.author}</span>
                            <span>ğŸ†” ID: ${post.id}</span>
                            <span>ğŸ“… ${new Date(post.created_at).toLocaleDateString('zh-CN')}</span>
                            <span class="status-badge ${statusClass}">
                                ${post.status === 'published' ? 'âœ… å·²å‘å¸ƒ' : 
                                  post.status === 'draft' ? 'ğŸ“ è‰ç¨¿' : 'ğŸ“¦ å·²å½’æ¡£'}
                            </span>
                        </div>
                        <div class="post-content">${post.content}</div>
                        ${post.excerpt ? `<div class="post-excerpt">ğŸ’¡ ${post.excerpt}</div>` : ''}
                    </div>
                `;
            });

            if (pagination) {
                html += `
                    <div class="pagination">
                        ğŸ“Š ç¬¬ ${pagination.page} é¡µï¼Œå…± ${pagination.totalPages} é¡µ | 
                        æ€»å…± ${pagination.total} ç¯‡æ–‡ç« 
                        ${pagination.page > 1 ? `<button onclick="loadPosts(${pagination.page - 1})">â¬…ï¸ ä¸Šä¸€é¡µ</button>` : ''}
                        ${pagination.page < pagination.totalPages ? `<button onclick="loadPosts(${pagination.page + 1})">â¡ï¸ ä¸‹ä¸€é¡µ</button>` : ''}
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // çŠ¶æ€ç­›é€‰
        function filterPosts() {
            loadPosts(1); // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
        }

        // åŠ è½½å•ç¯‡æ–‡ç« 
        async function loadSinglePost() {
            const postId = document.getElementById('postId').value;
            if (!postId) {
                alert('è¯·è¾“å…¥æ–‡ç« ID');
                return;
            }

            const container = document.getElementById('postsContainer');
            container.innerHTML = '<div class="loading">ğŸ” æ­£åœ¨æŸ¥æ‰¾æ–‡ç« ...</div>';

            try {
                const response = await fetch(`${API_BASE}/posts/${postId}`);
                if (!response.ok) {
                    throw new Error('æ–‡ç« ä¸å­˜åœ¨');
                }
                const post = await response.json();
                displayPosts([post], null);
            } catch (error) {
                container.innerHTML = `<div class="error">âŒ æŸ¥æ‰¾å¤±è´¥: ${error.message}</div>`;
            }
        }

        // åˆ‡æ¢åˆ›å»ºè¡¨å•
        function toggleCreateForm() {
            const form = document.getElementById('createForm');
            form.classList.toggle('show');
            if (form.classList.contains('show')) {
                document.getElementById('newTitle').focus();
            }
        }

        // åˆ›å»ºæ–°æ–‡ç« 
        async function createPost(event) {
            event.preventDefault();
            
            const title = document.getElementById('newTitle').value;
            const author = document.getElementById('newAuthor').value;
            const slug = document.getElementById('newSlug').value;
            const content = document.getElementById('newContent').value;
            const excerpt = document.getElementById('newExcerpt').value;
            const status = document.getElementById('newStatus').value;

            try {
                const response = await fetch(`${API_BASE}/posts`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title,
                        author,
                        slug,
                        content,
                        excerpt,
                        status
                    })
                });

                if (response.ok) {
                    alert('âœ… æ–‡ç« åˆ›å»ºæˆåŠŸï¼');
                    toggleCreateForm();
                    // æ¸…ç©ºè¡¨å•
                    event.target.reset();
                    // é‡æ–°åŠ è½½æ–‡ç« åˆ—è¡¨
                    loadPosts();
                } else {
                    throw new Error('åˆ›å»ºå¤±è´¥');
                }
            } catch (error) {
                alert(`âŒ åˆ›å»ºå¤±è´¥: ${error.message}`);
            }
        }
    </script>
</body>
</html>
