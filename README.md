# Cloudflare D1 åšå®¢ API

åŸºäº Cloudflare Workers å’Œ D1 æ•°æ®åº“æ„å»ºçš„ç°ä»£åŒ–åšå®¢ API ç³»ç»Ÿã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•ä¸€ï¼šä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰
```bash
./quick-start.sh
```

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰è®¾ç½®å’Œæµ‹è¯•æ­¥éª¤ã€‚

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨è®¾ç½®

#### 1. ç¯å¢ƒéªŒè¯
```bash
./test-d1-setup.sh
```

#### 2. åˆå§‹åŒ–æ•°æ®åº“
```bash
npm run db:init:local
```

#### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
npm run dev
```

#### 4. æµ‹è¯• API
```bash
./test-api.sh
```

## ğŸ“‹ ç¡®è®¤ D1 å¯ç”¨æ€§æ£€æŸ¥æ¸…å•

### âœ… å‰ç½®æ¡ä»¶
- [ ] Node.js >= 18.0.0
- [ ] npm å·²å®‰è£…
- [ ] Wrangler CLI å·²å®‰è£…å¹¶ç™»å½•
- [ ] Cloudflare è´¦æˆ·æœ‰ D1 è®¿é—®æƒé™

### âœ… é¡¹ç›®é…ç½®
- [ ] `wrangler.toml` é…ç½®æ­£ç¡®
- [ ] æ•°æ®åº“ ID å·²æ›´æ–°ï¼ˆéç¤ºä¾‹IDï¼‰
- [ ] æ‰€æœ‰å¿…éœ€æ–‡ä»¶å­˜åœ¨

### âœ… æœ¬åœ°æµ‹è¯•
- [ ] æœ¬åœ°æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
- [ ] å¼€å‘æœåŠ¡å™¨å¯åŠ¨æ­£å¸¸
- [ ] æ‰€æœ‰ API ç«¯ç‚¹å“åº”æ­£ç¡®
- [ ] CRUD æ“ä½œåŠŸèƒ½æ­£å¸¸

### âœ… ç”Ÿäº§ç¯å¢ƒ
- [ ] ç”Ÿäº§æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
- [ ] Worker éƒ¨ç½²æˆåŠŸ
- [ ] ç”Ÿäº§ API å¯æ­£å¸¸è®¿é—®
- [ ] æ•°æ®æŒä¹…åŒ–æ­£å¸¸

## ğŸ› ï¸ å¯ç”¨è„šæœ¬

| è„šæœ¬ | ç”¨é€” | å‘½ä»¤ |
|------|------|------|
| `test-d1-setup.sh` | ç¯å¢ƒå’Œé…ç½®éªŒè¯ | `./test-d1-setup.sh` |
| `test-api.sh` | API åŠŸèƒ½æµ‹è¯• | `./test-api.sh [URL]` |
| `quick-start.sh` | ä¸€é”®å®Œæ•´è®¾ç½® | `./quick-start.sh` |

## ğŸ“š API æ–‡æ¡£

### ç«¯ç‚¹

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° |
|------|------|------|
| GET | `/api/posts` | è·å–å¸–å­åˆ—è¡¨ |
| GET | `/api/posts/:id` | è·å–å•ä¸ªå¸–å­ |
| POST | `/api/posts` | åˆ›å»ºæ–°å¸–å­ |
| PUT | `/api/posts/:id` | æ›´æ–°å¸–å­ |
| DELETE | `/api/posts/:id` | åˆ é™¤å¸–å­ |

### æŸ¥è¯¢å‚æ•°

**GET /api/posts**
- `page`: é¡µç  (é»˜è®¤ 1)
- `limit`: æ¯é¡µæ•°é‡ (é»˜è®¤ 10)
- `status`: å¸–å­çŠ¶æ€ (published/draft/archived)

### ç¤ºä¾‹è¯·æ±‚

#### åˆ›å»ºå¸–å­
```bash
curl -X POST "http://localhost:8787/api/posts" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "æ–°åšå®¢æ–‡ç« ",
    "content": "æ–‡ç« å†…å®¹...",
    "author": "ä½œè€…åç§°",
    "slug": "new-blog-post",
    "status": "published",
    "excerpt": "æ–‡ç« æ‘˜è¦"
  }'
```

#### è·å–å¸–å­
```bash
curl "http://localhost:8787/api/posts?page=1&limit=5"
```

## ğŸ§ª æµ‹è¯•åŠŸèƒ½

### è‡ªåŠ¨åŒ–æµ‹è¯•åŒ…æ‹¬ï¼š
- âœ… ç¯å¢ƒä¾èµ–éªŒè¯
- âœ… Cloudflare è®¤è¯æ£€æŸ¥
- âœ… D1 æ•°æ®åº“æƒé™éªŒè¯
- âœ… æœ¬åœ°æ•°æ®åº“åˆå§‹åŒ–
- âœ… API ç«¯ç‚¹åŠŸèƒ½æµ‹è¯•
- âœ… CRUD æ“ä½œæµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•
- âœ… åŸºç¡€æ€§èƒ½æµ‹è¯•

### æµ‹è¯•æŠ¥å‘Šç¤ºä¾‹
```
ğŸ§ª æµ‹è¯•: è·å–å¸–å­åˆ—è¡¨
è¯·æ±‚: GET /posts
çŠ¶æ€ç : 200
å“åº”: {"posts":[...],"pagination":{"page":1,"limit":10,"total":2}}
âœ… æµ‹è¯•é€šè¿‡

======== æµ‹è¯•æ€»ç»“ ========
æ€»æµ‹è¯•æ•°: 15
é€šè¿‡æµ‹è¯•: 15
å¤±è´¥æµ‹è¯•: 0
æˆåŠŸç‡: 100.0%

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼API å·¥ä½œæ­£å¸¸
```

## ğŸ”§ å¼€å‘å‘½ä»¤

```bash
# å¼€å‘ç¯å¢ƒ
npm run dev                    # å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨
npm run db:init:local         # åˆå§‹åŒ–æœ¬åœ°æ•°æ®åº“
npm run db:query             # æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢

# ç”Ÿäº§ç¯å¢ƒ
npm run deploy               # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
npm run db:init:remote       # åˆå§‹åŒ–ç”Ÿäº§æ•°æ®åº“
npm run db:info              # æŸ¥çœ‹æ•°æ®åº“ä¿¡æ¯

# æ•°æ®åº“ç®¡ç†
npx wrangler d1 list                                                    # åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“
npx wrangler d1 execute simple-blog-db --command="SELECT * FROM posts;" --local  # æŸ¥è¯¢æœ¬åœ°æ•°æ®
npx wrangler d1 execute simple-blog-db --command="SELECT * FROM posts;" --remote # æŸ¥è¯¢ç”Ÿäº§æ•°æ®
```

## ğŸ“– è¯¦ç»†æ–‡æ¡£

- [D1æµ‹è¯•éªŒè¯æŒ‡å—.md](./D1æµ‹è¯•éªŒè¯æŒ‡å—.md) - å®Œæ•´çš„æµ‹è¯•å’ŒéªŒè¯æµç¨‹
- [ç®€åŒ–åšå®¢éƒ¨ç½²æŒ‡å—.md](./ç®€åŒ–åšå®¢éƒ¨ç½²æŒ‡å—.md) - è¯¦ç»†çš„éƒ¨ç½²è¯´æ˜
- [blog_config.md](./blog_config.md) - åšå®¢é…ç½®è¯´æ˜

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç¯å¢ƒéªŒè¯å¤±è´¥
```bash
# é‡æ–°å®‰è£… Wrangler
npm install -g @cloudflare/wrangler

# é‡æ–°ç™»å½•
npx wrangler login
```

#### 2. æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥æ•°æ®åº“é…ç½®
npx wrangler d1 info simple-blog-db

# éªŒè¯æ•°æ®åº“ ID
grep "database_id" wrangler.toml
```

#### 3. æœ¬åœ°æœåŠ¡å™¨å¯åŠ¨å¤±è´¥
```bash
# æ¸…ç†ç¼“å­˜
rm -rf .wrangler

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8787

# é‡æ–°å¯åŠ¨
npm run dev
```

#### 4. API æµ‹è¯•å¤±è´¥
```bash
# æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
curl http://localhost:8787

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
npx wrangler tail
```

### è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹ `wrangler.log` æ–‡ä»¶
2. è¿è¡Œ `./test-d1-setup.sh` é‡æ–°éªŒè¯ç¯å¢ƒ
3. æ£€æŸ¥ [Cloudflare D1 æ–‡æ¡£](https://developers.cloudflare.com/d1/)

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ç›®æ ‡æ€§èƒ½
- å“åº”æ—¶é—´: < 500ms
- æ•°æ®åº“æŸ¥è¯¢: < 100ms
- å†…å­˜ä½¿ç”¨: < 64MB
- å¯åŠ¨æ—¶é—´: < 2s

### ç›‘æ§å‘½ä»¤
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
npx wrangler tail

# æ€§èƒ½æµ‹è¯•
./test-api.sh

# æ•°æ®åº“ç»Ÿè®¡
npx wrangler d1 info simple-blog-db
```

## ğŸš¢ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### è‡ªåŠ¨éƒ¨ç½²
```bash
./quick-start.sh  # é€‰æ‹©éƒ¨ç½²é€‰é¡¹
```

### æ‰‹åŠ¨éƒ¨ç½²
```bash
# 1. åˆå§‹åŒ–ç”Ÿäº§æ•°æ®åº“
npm run db:init:remote

# 2. éƒ¨ç½² Worker
npm run deploy

# 3. æµ‹è¯•ç”Ÿäº§ç¯å¢ƒ
./test-api.sh YOUR_WORKER_URL
```

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ LICENSE æ–‡ä»¶
